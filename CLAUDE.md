炭酸水メーカーであるSoda Streamの炭酸水消費量とコストを記録・可視化するアプリケーションを作ります。

# general rules
- アプリケーションは英語で作成する
- 背景色は白とする
- dockerで使用することを前提とします。プロジェクトにはdockerfileを含め、docker-compose.ymlを作成してDBと同時に起動できるように設定します。

# 主要な機能
- 炭酸水の消費量を日別に記録して計算
    - コストの比較基準である市販の炭酸水と比較するために消費量を記録します。
    - 日付と消費量を入力(日付はカレンダーから選択する(default = 入力時点の日)。消費量は1L bottle=840mL, 0.5L bottle=455mlとして、ボトル数を入力。簡単に入力するために+1, -1ボタンを用意)
    - 入力されたデータはDBに保存
    - データのcsv inport, export機能を実装
    - 消費量のグラフ表示
        - 30days, 90days, 180days, 365daysの表示を切り替え可能
        - 折れ線グラフで表示
        - 市販の炭酸水をJPY45/500mLとして基準として表示する
- 二酸化炭素の消費の記録と計算
    - 炭酸水のコストは炭酸水の量ではなく二酸化炭素の消費量に依存するため、これを記録します。
    - 二酸化炭素シリンダーを管理します。#1から順に番号を振ります。
    - 二酸化炭素はボタンのプッシュ回数で記録します。default = 1L bottle: 4 push, 0.5L bottle: 2 push。これを指定したシリンダーに割り当てます。シリンダー選択のUIでは現在そのシリンダーに割り当てられている記録の日付の範囲を表示できるようにします。
    - シリンダー交換時用のボタンをUIに用意します。デフォルトの割り当て先シリンダーが新しいシリンダーに変わります。
    - シリンダーは番号ごとにコストを入力できます。
- 期間内炭酸水、二酸化炭素消費量の平均値を計算して表示
- 設定にinitial costとしてSoda Streamの購入費用を入力し、コストの最初に加算します。

# UI

## Executive Summary
アプリケーションの機能を整理し、ユーザー体験を考慮して以下のビューを実装します。
1.  **Dashboard View**: 日々の記録と主要な統計情報を一目で確認できるホーム画面。
2.  **History View**: 過去の全記録を一覧し、編集・削除を行う画面。
3.  **Analytics View**: 消費量とコストをグラフで詳細に分析する画面。
4.  **Cylinders View**: CO2シリンダーの管理とコスト設定に特化した画面。
5.  **Settings View**: データ移行やアプリケーションの基本設定を行う画面。

---

## ビュー構成

### 1. Dashboard View
アプリケーションのメイン画面です。最も頻繁に行う「日々の消費量記録」を素早く行えるようにし、現在の状況をひと目で把握できるようにします。

* **目的**: 日々の消費記録の入力と、主要な統計情報のクイックサマリー表示。
* **主要なUI要素**:
    * **Quick Add Section**:
        * 日付ピッカー (デフォルトは当日)
        * ボトルサイズ選択 (1L / 0.5L)
        * 本数入力 (`+1`, `-1` ボタンと数値表示)
        * `Log Consumption` ボタン
    * **Summary Cards**:
        * `Today's Consumption`: 今日の消費量 (mL)
        * `This Month's Cost`: 今月の推定コスト (JPY)
        * `Savings vs. Retail`: 市販品と比較した今月の節約額
        * `Active Cylinder`: 現在使用中のシリンダー番号 (`#3`など)
    * **Consumption Chart Preview**:
        * 過去30日間の消費量を示す小さな折れ線グラフ。Analytics Viewへのリンクを兼ねる。
    * **Navigation Bar**: 他のビュー (History, Analytics, Cylinders, Settings) へ移動するためのメニュー。

### 2. History View
過去の記録をすべてリスト形式で確認し、管理するための画面です。

* **目的**: 記録の閲覧、編集、削除。
* **主要なUI要素**:
    * **Log List**:
        * 日付、消費量 (mL)、使用したCO2シリンダー番号が記載されたリスト。
        * 各項目をタップすると編集・削除が可能。
    * **Add New Log Button**: 新しい記録を追加するためのボタン。タップすると記録入力用のモーダルウィンドウ、または専用の入力画面を表示します。
    * **Search/Filter Bar**: 特定の日付や期間で記録を絞り込むための検索機能。

### 3. Analytics View
消費量とコストに関するデータをグラフで詳細に可視化し、分析するための画面です。

* **目的**: 長期的な消費傾向とコスト効率の可視化。
* **主要なUI要素**:
    * **Period Toggle Buttons**: グラフの表示期間を切り替えるボタン (`30d`, `90d`, `180d`, `365d`)。
    * **Main Chart**:
        * 消費量を表示する折れ線グラフ。
        * 市販の炭酸水コスト (例: `JPY 45 / 500mL`) を示す基準線を重ねて表示。
    * **Statistics Section**:
        * `Total Consumption`: 選択期間の総消費量。
        * `Average Daily Consumption`: 選択期間の日次平均消費量。
        * `Total Cost`: 選択期間の総コスト。
        * `Cost per Liter`: 1リットルあたりの平均コスト。

### 4. Cylinders View
CO2シリンダーの管理に特化した画面です。

* **目的**: CO2シリンダーの追加、コスト管理、および交換作業。
* **主要なUI要素**:
    * **Cylinder List**:
        * 登録されている全シリンダーの一覧 (例: `#1`, `#2`, ...)。
        * 各シリンダーのコストと、そのシリンダーに紐づけられた記録の日付範囲 (例: `2025-05-10 - 2025-06-20`) を表示。
        * 各項目をタップするとコストの編集が可能。
    * **Add New Cylinder Button**: 新しいシリンダーをリストに追加するためのボタン。
    * **Change Cylinder Button**: 現在使用するシリンダーを新しいものに切り替えるためのボタン。これを押すと、以降の記録は自動的に新しいシリンダーに紐づけられます。

### 5. Settings View
データのインポート/エクスポートや、アプリケーションの基本設定を行う画面です。

* **目的**: データ管理とアプリケーションのカスタマイズ。
* **主要なUI要素**:
    * **Data Management Section**:
        * `Import from CSV` ボタン。
        * `Export to CSV` ボタン。
    * **Configuration Section**:
        * `Retail Price Reference`: 市販炭酸水の比較基準価格を入力するフィールド (デフォルト: `JPY 45 / 500mL`)。
        * `Default Push Counts`: ボトルごとのCO2プッシュ回数のデフォルト値を設定するフィールド (1L Bottle, 0.5L Bottle)。
    * **About Section**:
        * アプリケーションのバージョン情報などを表示。

# Architecture
承知いたしました。更新された仕様書に基づき、アプリケーションの技術的な構成案を提案します。

## Executive Summary

アプリケーションは、ユーザーインターフェースを提供する**フロントエンド**、ビジネスロジックとデータアクセスを担う**バックエンドAPI**、そしてデータを永続化する**データベース**の3層で構成することを提案します。これら3つのコンポーネントは、`docker-compose`によって連携して動作するコンテナとして構築します。この構成により、各要素の独立性が保たれ、開発、テスト、デプロイが容易になります。

  - **アーキテクチャ**: 3層アーキテクチャ（フロントエンド、バックエンド、データベース）
  - **推奨技術スタック**: React (フロントエンド), FastAPI (バックエンド), PostgreSQL (データベース)
  - **コンテナ化**: `docker-compose` を用いて、3つのサービスを統合管理

-----

### 1 アプリケーションアーキテクチャ

アプリケーションは以下の3つの独立したサービスで構成されます。

1.  **Frontend (Client-side Application)**

      * **役割**: ユーザーが見て操作するUI（5つのビュー）を描画します。ユーザーからの入力（消費量の記録など）を受け取り、バックエンドAPIにリクエストを送信して結果を表示します。
      * **実行環境**: ユーザーのWebブラウザ。

2.  **Backend (Server-side API)**

      * **役割**: アプリケーションの頭脳として機能します。フロントエンドからのリクエストに基づき、コスト計算、平均値算出などのビジネスロジックを実行し、データベースとのデータの読み書きを行います。処理結果はJSON形式のAPIとしてフロントエンドに提供します。
      * **実行環境**: Dockerコンテナ。

3.  **Database**

      * **役割**: すべてのデータを永続的に保存します。これには日々の消費記録、CO2シリンダーの情報、ユーザー設定などが含まれます。
      * **実行環境**: Dockerコンテナ。

*テキストによる図の表現: [User's Browser (Frontend)] \<-\> [API (Backend)] \<-\> [Database]*

### 2 推奨技術スタック

仕様書の要件とモダンな開発効率を考慮し、以下の技術スタックを推奨します。

| コンポーネント | 推奨技術                               | 理由                                                                                                                              |
| :------------- | :------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------- |
| **フロントエンド** | **React** | コンポーネントベースのためUIの再利用性が高く、今回設計したビュー構成と好相性です。グラフ描画ライブラリ（Recharts, Chart.js）も豊富です。 |
| **バックエンド** | **Python (FastAPI)** | データ計算やCSV処理が得意なPythonをベースとし、高速で開発効率が高いフレームワークです。APIの仕様書を自動生成する機能も備えています。     |
| **データベース** | **PostgreSQL** | 高機能で信頼性の高いオープンソースのデータベースです。複雑なデータ構造にも柔軟に対応できます。                                            |

### 3 Dockerによるコンテナ構成

`docker-compose.yml` ファイルを使い、以下の3つのサービスを定義して一括で起動・停止できるようにします。

  * **`frontend` サービス**:
      * Reactアプリケーションを動作させるためのコンテナ。
      * `frontend/Dockerfile` を使ってビルドします。
      * ホストのポート（例: 3000）をコンテナのポートに接続します。
  * **`backend` サービス**:
      * FastAPIアプリケーションを動作させるためのコンテナ。
      * `backend/Dockerfile` を使ってビルドします。
      * データベースの接続情報などを環境変数として渡します。
  * **`db` サービス**:
      * PostgreSQLの公式イメージをベースにしたコンテナ。
      * データベースのユーザー名やパスワードを環境変数で設定します。
      * データを永続化するために、ホストマシンのディレクトリをコンテナのデータディレクトリにマウントします。

### 4 ディレクトリ構造案

プロジェクトルートに各サービスのディレクトリを配置するモノレポ（monorepo）形式の構成を提案します。

```
sodastream-tracker/
├── docker-compose.yml       # Dockerコンテナ構成定義ファイル
├── frontend/                # Reactアプリケーションのソースコード
│   ├── Dockerfile
│   ├── package.json
│   └── src/
│       ├── components/      # 共通UI部品 (Button, Card, etc.)
│       ├── views/           # 各画面 (DashboardView.js, etc.)
│       └── App.js
├── backend/                 # FastAPIアプリケーションのソースコード
│   ├── Dockerfile
│   ├── requirements.txt
│   └── app/
│       ├── main.py          # APIサーバーのエントリポイント
│       ├── routers/         # 各APIエンドポイントの定義 (logs.py, etc.)
│       ├── schemas.py       # APIのデータ形式定義
│       └── models.py        # データベースのテーブル定義
└── .gitignore
```

### 5 APIエンドポイント設計案

バックエンドが提供する主要なAPIエンドポイントの例です。フロントエンドはこれらのエンドポイントを呼び出して機能を実現します。

  * **消費記録 (Logs)**
      * `GET /api/logs`: 記録の一覧を取得
      * `POST /api/logs`: 新しい記録を作成
      * `PUT /api/logs/{log_id}`: 記録を更新
      * `DELETE /api/logs/{log_id}`: 記録を削除
  * **分析 (Analytics)**
      * `GET /api/analytics?period=30d`: 指定した期間の分析データを取得
  * **シリンダー (Cylinders)**
      * `GET /api/cylinders`: シリンダーの一覧を取得
      * `POST /api/cylinders`: 新しいシリンダーを作成
      * `PUT /api/cylinders/{cylinder_id}`: シリンダー情報を更新
  * **設定 (Settings)**
      * `GET /api/settings`: 現在の設定を取得
      * `PUT /api/settings`: 設定を更新
  * **データ入出力 (Data)**
      * `POST /api/data/import`: CSVファイルをアップロードしてインポート
      * `GET /api/data/export`: 全データをCSV形式でダウンロード